{% extends "admin/base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div style="background: #343a40; padding: 20px; border-radius: 5px;">
        <h4 style="color: white; margin-bottom: 15px;">Workflow Management</h4>
        
        <!-- Add New Workflow Button -->
        <div style="margin-bottom: 20px;">
            <button type="button" style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;"
                    onclick="alert('Create new workflow functionality')">
                Add New Workflow
            </button>
        </div>

        <!-- Current Workflows -->
        <div style="margin-bottom: 30px;">
            <h5 style="color: white; margin-bottom: 15px;">Your Organization's Workflows</h5>
            {% if workflows %}
                {% for workflow in workflows %}
                <div style="background: #495057; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #0d6efd;">
                    <h6 style="color: white; margin-bottom: 5px;">{{ workflow.name }}</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">{{ workflow.description }}</p>
                    <span style="background: {% if workflow.is_active %}#28a745{% else %}#6c757d{% endif %}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">
                        {% if workflow.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #adb5bd; text-align: center; padding: 40px;">No workflows found. Import a template below to get started.</p>
            {% endif %}
        </div>

        <!-- Workflow Library Templates -->
        <div style="background: #2c3034; padding: 20px; border-radius: 5px;">
            <h5 style="color: white; margin-bottom: 15px;">Workflow Library Templates</h5>
            <p style="color: #adb5bd; margin-bottom: 15px;">Import and customize these predefined workflow templates</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                
                <!-- Problem-to-Business Case Workflow -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #dc3545;">
                    <h6 style="color: white; margin-bottom: 8px;">Problem-to-Business Case Workflow</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Complete workflow from problem identification to business case creation with triage rules</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Problems</span>
                        <button onclick="importTemplate('Problem-to-Business Case Workflow')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Business Case Review & Approval -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #0d6efd;">
                    <h6 style="color: white; margin-bottom: 8px;">Business Case Review & Approval</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Multi-stage business case review process with BA assignment and ROI validation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #0d6efd; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Business</span>
                        <button onclick="importTemplate('Business Case Review & Approval')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Epic & Story Management -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #0d6efd;">
                    <h6 style="color: white; margin-bottom: 8px;">Epic & Story Management</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">AI-powered epic creation and user story breakdown with requirements generation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #0d6efd; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Business</span>
                        <button onclick="importTemplate('Epic & Story Management')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Business Case to Project Conversion -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
                    <h6 style="color: white; margin-bottom: 8px;">Business Case to Project Conversion</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Automated conversion from approved business cases to project management with milestone creation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Projects</span>
                        <button onclick="importTemplate('Business Case to Project Conversion')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Project Review & Milestone Tracking -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #28a745;">
                    <h6 style="color: white; margin-bottom: 8px;">Project Review & Milestone Tracking</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Project milestone monitoring with automated notifications and success prediction</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #28a745; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Projects</span>
                        <button onclick="importTemplate('Project Review & Milestone Tracking')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Solution Recommendation Process -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #6f42c1;">
                    <h6 style="color: white; margin-bottom: 8px;">Solution Recommendation Process</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">AI-powered solution recommendation engine with implementation workflow</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #6f42c1; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Solutions</span>
                        <button onclick="importTemplate('Solution Recommendation Process')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Department Escalation Workflow -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #fd7e14;">
                    <h6 style="color: white; margin-bottom: 8px;">Department Escalation Workflow</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Hierarchical department escalation with role-based routing and approval chains</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #fd7e14; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Departments</span>
                        <button onclick="importTemplate('Department Escalation Workflow')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Notification & Alert Management -->
                <div style="background: #495057; padding: 15px; border-radius: 5px; border-left: 4px solid #20c997;">
                    <h6 style="color: white; margin-bottom: 8px;">Notification & Alert Management</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">Automated notification system with email integration and workflow triggers</p>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="background: #20c997; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">Notifications</span>
                        <button onclick="importTemplate('Notification & Alert Management')" 
                               style="background: #28a745; color: white; padding: 5px 12px; border: none; border-radius: 3px; font-size: 12px; cursor: pointer;">
                            Import
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
function importTemplate(templateName) {
    if (confirm('Import "' + templateName + '" template? This will create a new workflow that you can customize.')) {
        // Create a form to POST the import request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/workflows-import';
        
        const templateField = document.createElement('input');
        templateField.type = 'hidden';
        templateField.name = 'template_name';
        templateField.value = templateName;
        form.appendChild(templateField);
        
        // Add CSRF token if available
        const csrfToken = document.querySelector('meta[name="csrf-token"]');
        if (csrfToken) {
            const csrfField = document.createElement('input');
            csrfField.type = 'hidden';
            csrfField.name = 'csrf_token';
            csrfField.value = csrfToken.getAttribute('content');
            form.appendChild(csrfField);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}