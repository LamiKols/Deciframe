{% extends "admin/base.html" %}

{% block content %}
<div class="container-fluid py-4">
    <div style="background: #343a40; padding: 20px; border-radius: 5px;">
        <h4 style="color: white; margin-bottom: 15px;">Workflow Management</h4>
        
        <!-- Current Status Summary -->
        <div style="background: #2c3034; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
            <h5 style="color: white; margin-bottom: 10px;">Current System Status</h5>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                <div style="background: #28a745; color: white; padding: 10px; border-radius: 3px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;">4</div>
                    <div style="font-size: 12px;">Active Workflows</div>
                </div>
                <div style="background: #6c757d; color: white; padding: 10px; border-radius: 3px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;">4</div>
                    <div style="font-size: 12px;">Available Templates</div>
                </div>
                <div style="background: #fd7e14; color: white; padding: 10px; border-radius: 3px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;">0</div>
                    <div style="font-size: 12px;">Triage Rules</div>
                </div>
                <div style="background: #20c997; color: white; padding: 10px; border-radius: 3px; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold;">30min</div>
                    <div style="font-size: 12px;">Auto-Schedule</div>
                </div>
            </div>
        </div>

        <!-- Add New Workflow Button -->
        <div style="margin-bottom: 20px;">
            <button type="button" style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer;"
                    onclick="alert('Create new workflow functionality')">
                Add New Workflow
            </button>
        </div>

        <!-- Current Workflows -->
        <div style="margin-bottom: 30px;">
            <h5 style="color: white; margin-bottom: 15px;">Your Organization's Workflows</h5>
            {% if workflows %}
                {% for workflow in workflows %}
                <div style="background: #495057; padding: 15px; border-radius: 5px; margin-bottom: 10px; border-left: 4px solid #0d6efd;">
                    <h6 style="color: white; margin-bottom: 5px;">{{ workflow.name }}</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 10px;">{{ workflow.description }}</p>
                    <span style="background: {% if workflow.is_active %}#28a745{% else %}#6c757d{% endif %}; color: white; padding: 2px 8px; border-radius: 3px; font-size: 12px;">
                        {% if workflow.is_active %}Active{% else %}Inactive{% endif %}
                    </span>
                </div>
                {% endfor %}
            {% else %}
                <p style="color: #adb5bd; text-align: center; padding: 40px;">No workflows found. Import a template below to get started.</p>
            {% endif %}
        </div>

        <!-- Workflow Library Templates -->
        <div style="background: #2c3034; padding: 20px; border-radius: 5px;">
            <h5 style="color: white; margin-bottom: 15px;">Workflow Library Templates</h5>
            <p style="color: #adb5bd; margin-bottom: 15px;">Import and customize these predefined workflow templates</p>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 20px;">
                
                <!-- Problem-to-Business Case Workflow - ACTIVE -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <div style="position: absolute; top: 15px; right: 15px; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold;">
                        ✓ ACTIVE
                    </div>
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600; padding-right: 60px;">Problem-to-Business Case Workflow</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Complete workflow from problem identification to business case creation with triage rules</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #dc3545; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Problems</span>
                        <button onclick="alert('This workflow is already active in your system')" 
                               style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Active
                        </button>
                    </div>
                </div>

                <!-- Business Case Review & Approval - ACTIVE -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #0d6efd; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <div style="position: absolute; top: 15px; right: 15px; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold;">
                        ✓ ACTIVE
                    </div>
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600; padding-right: 60px;">Business Case Review & Approval</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Multi-stage business case review process with BA assignment and ROI validation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #0d6efd; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Business</span>
                        <button onclick="alert('This workflow is already active in your system')" 
                               style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Active
                        </button>
                    </div>
                </div>

                <!-- Epic & Story Management - ACTIVE -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #0d6efd; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <div style="position: absolute; top: 15px; right: 15px; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold;">
                        ✓ ACTIVE
                    </div>
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600; padding-right: 60px;">Epic & Story Management</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">AI-powered epic creation and user story breakdown with requirements generation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #0d6efd; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Business</span>
                        <button onclick="alert('This workflow is already active in your system')" 
                               style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Active
                        </button>
                    </div>
                </div>

                <!-- Business Case to Project Conversion -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600;">Business Case to Project Conversion</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Automated conversion from approved business cases to project management with milestone creation</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Projects</span>
                        <button onclick="importTemplate('Business Case to Project Conversion')" 
                               style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Project Review & Milestone Tracking -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #28a745; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600;">Project Review & Milestone Tracking</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Project milestone monitoring with automated notifications and success prediction</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #28a745; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Projects</span>
                        <button onclick="importTemplate('Project Review & Milestone Tracking')" 
                               style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Solution Recommendation Process -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #6f42c1; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600;">Solution Recommendation Process</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">AI-powered solution recommendation engine with implementation workflow</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #6f42c1; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Solutions</span>
                        <button onclick="importTemplate('Solution Recommendation Process')" 
                               style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Department Escalation Workflow -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #fd7e14; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600;">Department Escalation Workflow</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Hierarchical department escalation with role-based routing and approval chains</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #fd7e14; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Departments</span>
                        <button onclick="importTemplate('Department Escalation Workflow')" 
                               style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Import
                        </button>
                    </div>
                </div>

                <!-- Notification & Alert Management - ACTIVE -->
                <div style="background: #495057; padding: 20px; border-radius: 8px; border-left: 4px solid #20c997; position: relative; min-height: 160px; display: flex; flex-direction: column;">
                    <div style="position: absolute; top: 15px; right: 15px; background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 10px; font-weight: bold;">
                        ✓ ACTIVE
                    </div>
                    <h6 style="color: white; margin-bottom: 12px; font-size: 16px; font-weight: 600; padding-right: 60px;">Notification & Alert Management</h6>
                    <p style="color: #adb5bd; font-size: 14px; margin-bottom: 15px; flex-grow: 1; line-height: 1.4;">Automated notification system with email integration and workflow triggers</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                        <span style="background: #20c997; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 500;">Notifications</span>
                        <button onclick="alert('This workflow is already active in your system')" 
                               style="background: #6c757d; color: white; padding: 8px 16px; border: none; border-radius: 4px; font-size: 12px; cursor: pointer; font-weight: 500;">
                            Active
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<script>
function importTemplate(templateName) {
    if (confirm('Import "' + templateName + '" template? This will create a new workflow that you can customize.')) {
        // Create a form to POST the import request
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/admin/workflows-import';
        
        const templateField = document.createElement('input');
        templateField.type = 'hidden';
        templateField.name = 'template_name';
        templateField.value = templateName;
        form.appendChild(templateField);
        
        // Add CSRF token if available
        const csrfToken = document.querySelector('meta[name="csrf-token"]');
        if (csrfToken) {
            const csrfField = document.createElement('input');
            csrfField.type = 'hidden';
            csrfField.name = 'csrf_token';
            csrfField.value = csrfToken.getAttribute('content');
            form.appendChild(csrfField);
        }
        
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}